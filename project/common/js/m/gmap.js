if(window.registerLoading){registerLoading("m/gmap")}(function(factory){if(typeof rrequire==="function"){rrequire(["j/jquery","j/jquery.ui","static","m/maputils","m/wicket.src","m/wicket-gmap3.src","googlemap"],factory)}else{factory(jQuery,window)}}(function($,scope){var wn_evt,hasOwn=Object.prototype.hasOwnProperty,mouseDown=false,mouseButton=0,paintSelect=false,paintDeselect=false,paintExclude=false,paintUnexclude=false,ctrlKeyPressed=false,shiftKeyPressed=false,currentPolygon=null,uuid=2000000;scope.MAP_MULTI_SELECT={DISABLE:-1,SINGLE:0,CLICK:1,CTRL:2,TOGGLE:4,PAINT:8,RIGHT:16,SHIFT:32};scope.MAP_POINTER_EVENTS={NONE:-1,LEVEL:0,ANY:1,ALL:2};$.widget("cms.gmap",{options:{map:{mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,rotateControl:false,streetViewControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},scaleControl:false,mapTypeControl:false,disableDoubleClickZoom:true,draggable:true,scrollwheel:true,styles:[{stylers:[{hue:"#68c0ff"},{saturation:20}]},{featureType:"road",stylers:[{weight:0.5}]}]},level:0,multiSelect:MAP_MULTI_SELECT.TOGGLE|MAP_MULTI_SELECT.PAINT,pointerEvents:MAP_POINTER_EVENTS.LEVEL,preciseFit:false,colors:{standard:{strokeColor:"#1e1b1a",fillColor:"#cccccc",strokeOpacity:0.2,fillOpacity:0.1},selected:{strokeColor:"#8667ab",fillColor:"#8667ab",strokeOpacity:1,fillOpacity:0.5},highlight:{strokeColor:"#6a37a6",fillColor:"#9a61de",strokeOpacity:1,fillOpacity:0.5},add:{strokeColor:"#64cb66",fillColor:"#64cb66",strokeOpacity:1,fillOpacity:0.5},remove:{strokeColor:"#f35958",fillColor:"#f35958",strokeOpacity:1,fillOpacity:0.4},hover:{strokeColor:"#8667ab",fillColor:"#8667ab",strokeOpacity:0.5,fillOpacity:0.2},circle:{strokeWeight:2,strokeColor:"#566b7e",strokeOpacity:0.7,fillOpacity:0.1},excluded:{strokeColor:"#b85842",fillColor:"#d8664c",strokeOpacity:1,fillOpacity:0.5}},pinAnimation:google.maps.Animation.DROP},_create:function(){var data,v;if(this.options.data===true){data=this.element.data();for(var p in data){if(!hasOwn.call(data,p)){continue}else{v=data[p];if(typeof v==="string"||typeof v==="number"||typeof v==="boolean"||$.isArray(v)||$.isPlainObject(v)){this.options[p]=v}}}}switch(this.options.country){case"CA":case"CAN":CMS.Map.Country="CAN";break}this.map=new google.maps.Map(this.element[0],this.options.map);this._handle=google.maps.event.addListener(this.map,"idle",$.proxy(this._setup,this));this._polygons={};this._highlight={};this._selected={};this._excluded={};this._active={};this._protected={};this._icons={};this._activeIcons={};if(this.options.locations){for(var i=0;i<this.options.locations.length;i++){this._selected[this.options.locations[i]]=true}}},_setup:function(){var gmap;google.maps.event.removeListener(this._handle);google.maps.event.addListener(this.map,"dragend",$.proxy(this._onDrag,this));google.maps.event.addListener(this.map,"zoom_changed",$.proxy(this._onZoom,this));if(this.options.latitude&&this.options.longitude){this.setLatLng({lat:Make.Float(this.options.latitude),lng:Make.Float(this.options.longitude)},this.options.zoom)}else{if(this.fitBounds(this.options)){}else{if(this.options.address){this.setAddress(this.options.address,this._ready.bind(this));return}else{this.update()}}}this._ready()},_ready:function(latlng){if(this.options.autopin){if(this.options.address){$.cms.gmap.getLatLng(this.options.address,function(latlng){this.setPin(latlng,this.options.icon,true)}.bind(this))}else{this.setPin(this.center(),this.options.icon,true)}}this._trigger("ready")},_onDrag:function(){this.update();this._trigger("dragged")},getMap:function(){return this.map},_onZoom:function(e){this.update();this._trigger("zoomed")},setLatLng:function(latlng,zoom,results,status){if(latlng){this.map.setCenter(latlng);this.map.setZoom(zoom||10);this.update()}},fitBounds:function(extents){var minLat,maxLat,minLng,maxLng,x,y,bounds;if(extents&&extents.constructor===google.maps.LatLngBounds){this.map.fitBounds(extents);this.update();return true}if(!extents||!$.isPlainObject(extents)){return}minLat=Make.Float(extents.MinLat||extents.minLat||extents.minlat);maxLat=Make.Float(extents.MaxLat||extents.maxLat||extents.maxlat);minLng=Make.Float(extents.MinLng||extents.minLng||extents.minlng);maxLng=Make.Float(extents.MaxLng||extents.maxLng||extents.maxlng);x=maxLng-minLng;y=maxLat-minLat;if(x>0&&y>0){if(!this.options.preciseFit){minLng+=(x*0.1);maxLng-=(x*0.1);minLat+=(y*0.1);maxLat-=(y*0.1)}bounds=new google.maps.LatLngBounds(new google.maps.LatLng(minLat,minLng),new google.maps.LatLng(maxLat,maxLng));this.map.fitBounds(bounds);this.update();return true}return false},fitActive:function(){var poly,item,row,extents={};for(var p in this._active){if(hasOwn.call(this._active,p)){$.cms.gmap.extend(extents,this._polygons[p])}}this.fitBounds(extents)},setAddress:function(address,zoom,callback){var fn;if($.isFunction(zoom)){callback=zoom;zoom=this.options.zoom}fn=function(gmap){return function(latlng){gmap.setLatLng.call(gmap,latlng,zoom);if($.isFunction(callback)){callback.apply(gmap.element[0],arguments)}}}(this);$.cms.gmap.getLatLng(address,fn)},zoom:function(amount){if(amount===undefined){return this.map.getZoom()}else{if(amount==="+1"){this.map.setZoom(this.map.getZoom()+1)}else{if(amount==="-1"){this.map.setZoom(this.map.getZoom()-1)}else{this.map.setZoom(amount)}}}},update:function(){if(this._timer){clearTimeout(this._timer)}this._timer=setTimeout($.proxy(this._update,this),100)},_update:function(){var bounds=this.map.getBounds(),sw=bounds&&bounds.getSouthWest(),ne=bounds&&bounds.getNorthEast(),extents=bounds&&{minLat:sw.lat(),minLng:sw.lng(),maxLat:ne.lat(),maxLng:ne.lng()};if(!extents){return}this._trigger("update",{},extents);if(this.options.level){CMS.Map.Require(extents,this.options.level,$.proxy(this._loadLevel,this),this.options.canada?"CAN":undefined)}},_loadLevel:function(){var rows,bounds=this.map.getBounds(),sw=bounds&&bounds.getSouthWest(),ne=bounds&&bounds.getNorthEast(),extents=bounds&&{minLat:sw.lat(),minLng:sw.lng(),maxLat:ne.lat(),maxLng:ne.lng()};rows=CMS.Map.Match(this.options.level,extents);this.addPolygons(rows);this._trigger("loaded",{},{extents:extents,rows:rows})},setLevel:function(level){var poly,item,row;level=Make.Int(level);if(level==this.options.level){return}this.options.level=level;for(var p in this._active){if(hasOwn.call(this._active,p)){poly=this._polygons[p];item=(poly&&poly.list)||poly;row=item&&item.row;if(!row||row.level!=level){this._setPolyOptions(poly,{map:null});delete this._active[p]}}}this._selected=this._getSelected();this.update();this.notifySelected()},getCenter:function(){var c=this.map.getCenter();return{lat:c.lat(),lng:c.lng()}},center:function(lat,lng){var c;if(lat===undefined){c=this.map.getCenter();return{lat:c.lat(),lng:c.lng()}}else{if(lat.lat){this.map.setCenter(lat)}else{if(lat&&lng){this.map.setCenter({lat:lat,lng:lng})}else{console.log("Could not set map center",Array.prototype.slice.call(arguments))}}}},pan:function(x,y){x=Make.Float(x);y=Make.Float(y);if(!x&&!y){return}if(x>-1&&x<1&&y>-1&&y<1){x*=this.element.width();y*=this.element.height()}this.map.panBy(x,y)},addPolygons:function(rows){var size,poly;if(!rows||!rows.length){return}size=rows.length;while(size--){this.addPolygon(rows[size])}},addPolygon:function(row,alt){var p,poly,wkt,len;if(typeof row==="number"||typeof row==="string"){row=CMS.Map.Locations[row]}if(!row){console.log("Missing polygon row data.");return}if(!alt&&row.alt){alt=row.alt}if(!row.id){row.id=uuid++}if(!(poly=this._polygons[row.id])){if(row.lat&&row.lng&&row.radius){poly=new google.maps.Circle({center:{lat:Make.Float(row.lat),lng:Make.Float(row.lng)},radius:Make.Float(row.radius),map:this.map})}else{try{wkt=new Wkt.Wkt();wkt.read(row.poly);poly=wkt.toObject({reverseInnerPolygons:false})}catch(ex){console.log("Error",row);return}}poly.row=row;if(alt){poly.alt=alt}if($.isArray(poly)){len=poly.length;while(len--){poly[len].list=poly;this._setupPoly(poly[len])}}else{this._setupPoly(poly)}this._polygons[row.id]=poly;if(this._selected[row.id]){poly.selected=true}else{if(this._excluded[row.id]){poly.excluded=true}else{if(this._highlight[row.id]){poly.highlight=true}else{if(!this.options.level||row.level==this.options.level){this._active[row.id]=1}}}}if(this._protected[row.id]){poly["protected"]=true}}else{if(!this._active[row.id]&&row.level==this.options.level){this._active[row.id]=1;this._setPolyOptions(poly,{map:this.map})}}if(this._active[row.id]){this._updatePolyStyle(poly)}return poly},refresh:function(){var poly;for(var p in this._active){if(hasOwn.call(this._active,p)&&(poly=this._polygons[p])){this._updatePolyStyle(poly)}}},addCircle:function(center,radius,style){var poly=new google.maps.Circle({center:center,radius:radius,map:this.map});poly.setOptions(style||this.options.colors.circle);return poly},removePolygon:function(id){var poly=id&&this._polygons[id];if(poly){delete this._active[id];this._setPolyOptions(poly,{map:null})}},removePolygons:function(ids){if(!ids){return this.removePolygons(Object.keys(this._active))}for(var i=0;i<ids.length;i++){this.removePolygon(ids[i])}},addOverlay:function(options){var o=new $.cms.gmap.overlay(this.map,options);o.show();return o},_setState:function(poly,state,style){var item=poly.list||poly,selected,excluded,toggle=(this.options.multiSelect&MAP_MULTI_SELECT.TOGGLE)===MAP_MULTI_SELECT.TOGGLE,ctrl=ctrlKeyPressed&&(this.options.multiSelect&MAP_MULTI_SELECT.CTRL)===MAP_MULTI_SELECT.CTRL,shiftExclude=shiftKeyPressed&&(this.options.multiSelect&MAP_MULTI_SELECT.SHIFT)===MAP_MULTI_SELECT.SHIFT;switch(state){case"mouseover":item.over=true;break;case"mouseout":item.over=false;break;case"highlight":item.highlight=true;break;case"unhighlight":item.highlight=false;break;case"click":if(shiftExclude){excluded=(toggle||ctrl)?!item.excluded:true;this._setExcludeState(item,excluded,toggle||ctrl)}else{selected=(toggle||ctrl)?!item.selected:true;this._setSelectState(item,selected,toggle||ctrl)}return}this._updatePolyStyle(item,style,toggle||ctrl,shiftExclude)},_setSelectState:function(item,selected,multi,conceal){var row=item.row;if(!multi){this.clearSelection()}else{if(!item.selected===!selected){return}}item.selected=!!selected;if(row&&row.id){if(item.selected){this._selected[row.id]=true;if(item.excluded){item.excluded=false;delete this._excluded[row.id]}}else{delete this._selected[row.id]}}this._updatePolyStyle(item,null,multi);if(!conceal){this.notifySelected()}},_setExcludeState:function(item,excluded,multi,conceal){var row=item.row;if(!multi){this.clearExclusions()}else{if(!item.excluded===!excluded){return}}item.excluded=!!excluded;if(row&&row.id){if(item.excluded){this._excluded[row.id]=true;if(item.selected){item.selected=false;delete this._selected[row.id]}}else{delete this._excluded[row.id]}}this._updatePolyStyle(item,null,multi,true);if(!conceal){this.notifySelected()}},setProtected:function(items){this.unprotect();this.protect(Make.IntArray(items))},setSelection:function(items,conceal){var size,poly;this.clearSelection();items=Make.IntArray(items,true);size=items.length;while(size--){this._selected[items[size]]=true;poly=this._polygons[items[size]];if(poly){poly.selected=true;this._updatePolyStyle(poly)}}if(!conceal){this.notifySelected()}},clearSelection:function(){var poly;for(var p in this._polygons){if(hasOwn.call(this._polygons,p)){poly=this._polygons[p];if(poly&&poly.selected){poly.selected=false;this._updatePolyStyle(poly)}}}this._selected={}},setExclusion:function(items,conceal){var size,poly;this.clearExclusion();items=Make.IntArray(items,true);size=items.length;while(size--){this._excluded[items[size]]=true;poly=this._polygons[items[size]];if(poly){poly.excluded=true;this._updatePolyStyle(poly)}}if(!conceal){this.notifySelected()}},clearExclusion:function(){var poly;for(var p in this._polygons){if(hasOwn.call(this._polygons,p)){poly=this._polygons[p];if(poly&&poly.excluded){poly.excluded=false;this._updatePolyStyle(poly)}}}this._excluded={}},setPolygons:function(ids,fit){var size,dict,poly,row;ids=Make.IntArray(ids,true);size=ids.length;dict={};while(size--){dict[ids[size]]=true}for(var p in this._active){if(hasOwn.call(this._active,p)&&!dict[p]){poly=this._polygons[p];this._setPolyOptions(poly,{map:null});delete this._active[p];delete dict[p]}}for(var p in dict){if(hasOwn.call(dict,p)){poly=this._polygons[p];if(poly){this._active[p]=1;this._setPolyOptions(poly,{map:this.map});this._updatePolyStyle(poly)}else{row=CMS.Map.Locations[p];if(row){this._active[p]=1;this.addPolygon(row)}else{console.log("Couldn't find row",p)}}}}if(fit){}},_getSelected:function(){var poly,item,row,selected={};for(var p in this._polygons){if(hasOwn.call(this._polygons,p)){poly=this._polygons[p];item=(poly&&poly.list)||poly;row=item&&item.row;if(row&&item.selected&&row.level==this.options.level){selected[p]=true}}}return selected},notifySelected:function(){var poly,row,ids=[],rows=[],eids=[],erows=[];for(var p in this._selected){if(hasOwn.call(this._selected,p)){poly=this._polygons[p];row=(poly&&poly.row)||CMS.Map.Locations[p];rows[ids.length]=row;ids.push(p)}}for(var p in this._excluded){if(hasOwn.call(this._excluded,p)){poly=this._polygons[p];row=(poly&&poly.row)||CMS.Map.Locations[p];erows[eids.length]=row;eids.push(p)}}this._trigger("selected",null,{selected:ids,rows:rows,excluded:eids,erows:erows})},_updatePolyStyle:function(poly,style,multi,shiftExclude){var selected,excluded,over,highlight,defaults,colors,ecolors,opacity;if(!style){if(poly.list){selected=poly.list.selected;excluded=poly.list.excluded;over=poly.list.over;highlight=poly.list.highlight}else{selected=poly.selected;excluded=poly.excluded;over=poly.over;highlight=poly.highlight}if(shiftExclude&&over&&selected){selected=false}else{if(!shiftExclude&&over&&excluded){excluded=false}}defaults=this.options.colors;colors=(poly.alt&&defaults[poly.alt])||defaults;if(selected&&over&&multi){style=colors.remove||defaults.remove}else{if(excluded&&over&&multi){style=colors.removeexcluded||defaults.removeexcluded||colors.remove||defaults.remove}else{if(!selected&&!excluded&&over&&multi){if(shiftExclude){style=colors.addexcluded||defaults.addexcluded||colors.add||defaults.add}else{style=colors.add||defaults.add}}else{if(selected){style=colors.selected||defaults.selected}else{if(excluded){style=colors.excluded||defaults.excluded}else{if(highlight){style=colors.highlight||defaults.highlight}else{if(over){style=colors.hover||defaults.hover}else{style=colors.standard||defaults.standard}}}}}}}}this._setPolyOptions(poly,style);if(poly.opacity&&style.fillOpacity!==undefined){this._setPolyOptions(poly,{fillOpacity:style.fillOpacity*poly.opacity})}return style},_setPolyOptions:function(poly,options){if($.isArray(poly)){size=poly.length;while(size--){poly[size].setOptions(options)}return}poly.setOptions(options)},_setupPoly:function(poly){var item=poly.list||poly,row=item&&item.row,map=(!this.options.level||row.level==this.options.level)?this.map:null,options=$.extend({strokeWeight:0.5},{zIndex:2,map:map});poly.setOptions(options);item.level=row.level;poly.gmap=this;google.maps.event.addListener(poly,"mouseover",function(e){var item=this.list||this;currentPolygon=this;if($.cms.gmap.disabled(this.gmap)){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ALL){}else{if(item["protected"]){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ANY){}else{if(this.gmap.options.level&&this.gmap.options.level!=item.level){return}}}}}if(paintSelect||paintDeselect){this.gmap._setSelectState(item,paintSelect,true);this.gmap._trigger("paint",null,{item:item,row:item&&item.row,select:paintSelect});return}else{if(paintExclude||paintUnexclude){this.gmap._setExcludeState(item,paintExclude,true);return}}this.gmap._setState(this,"mouseover");this.gmap._trigger("highlight",null,{item:item,row:item&&item.row})});google.maps.event.addListener(poly,"mouseout",function(e){var item=this.list||this;currentPolygon=null;if($.cms.gmap.disabled(this.gmap)){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ALL){}else{if(item["protected"]){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ANY){}else{if(this.gmap.options.level&&this.gmap.options.level!=item.level){return}}}}}this.gmap._setState(this,"mouseout");this.gmap._trigger("unhighlight",null,{item:item,row:item&&item.row})});google.maps.event.addListener(poly,"mousedown",function(e){var item=this.list||this;if($.cms.gmap.disabled(this.gmap)){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ALL){}else{if(item["protected"]){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ANY){}else{if(this.gmap.options.level&&this.gmap.options.level!=item.level){return}}}}}if(paintSelect||paintDeselect){item.over=false;this.gmap._setSelectState(item,paintSelect,true);return}else{if(paintExclude||paintUnexclude){item.over=false;this.gmap._setExcludeState(item,paintExclude,true);return}}});google.maps.event.addListener(poly,"mouseup",function(e){var toggle,ctrl,item=this.list||this;if($.cms.gmap.disabled(this.gmap)){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ALL){}else{if(item["protected"]){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ANY){}else{if(this.gmap.options.level&&this.gmap.options.level!=item.level){return}}}}}item.over=true;toggle=$.cms.gmap.toggle(this.gmap);ctrl=ctrlKeyPressed&&$.cms.gmap.ctrl(this.gmap);this.gmap._updatePolyStyle(item,null,(toggle||ctrl))});google.maps.event.addListener(poly,"click",function(e){var stop,item=this.list||this;if($.cms.gmap.click(this.gmap)){stop=this.gmap.options.multiSelect===MAP_MULTI_SELECT.CLICK;this.gmap._trigger("click",null,{polygon:this,item:item,row:item.row});if(stop){return}}else{if($.cms.gmap.disabled(this.gmap)){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ALL){}else{if(item["protected"]){return}else{if(this.gmap.options.pointerEvents===MAP_POINTER_EVENTS.ANY){}else{if(this.gmap.options.level&&this.gmap.options.level!=item.level){return}}}}}}this.gmap._setState(this,"click")});if(map){this._active[row.id]=1}},clear:function(){var poly,item,row;for(var p in this._active){if(hasOwn.call(this._active,p)){poly=this._polygons[p];item=(poly&&poly.list)||poly;row=item&&item.row;delete item.over;this._setPolyOptions(poly,{map:null});delete this._active[p]}}},protect:function(id){var index,poly;if($.isArray(id)){index=id.length;while(index--){this.protect(id[index])}return}if(!id){return}this._protected[id]=true;poly=this._polygons[id];if(poly){poly["protected"]=true}},unprotect:function(id){var index,poly;if(!id){this.unprotect(Object.keys(this._protected));return}if($.isArray(id)){index=id.length;while(index--){this.unprotect(id[index])}return}if(!id){return}delete this._protected[id];poly=this._polygons[id];if(poly){poly["protected"]=false}},select:function(id,conceal){var index,poly;if($.isArray(id)){index=id.length;while(index--){this.select(id[index],true)}if(!conceal){this.notifySelected()}return}poly=id&&this._polygons[id];if(poly){this._setSelectState(poly,true,true,true)}if(!conceal){this.notifySelected()}},unselect:function(id,conceal){var index,poly;if(!id){this.unselect(Object.keys(this._selected));return}if($.isArray(id)){index=id.length;while(index--){this.unselect(id[index],true)}if(!conceal){this.notifySelected()}return}poly=id&&this._polygons[id];if(poly){this._setSelectState(poly,false,true,true)}else{delete this._selected[id]}if(!conceal){this.notifySelected()}},exclude:function(id,conceal){var index,poly;if($.isArray(id)){index=id.length;while(index--){this.exclude(id[index],true)}if(!conceal){this.notifySelected()}return}poly=id&&this._polygons[id];if(poly){this._setExcludeState(poly,true,true,true)}if(!conceal){this.notifySelected()}},unexclude:function(id,conceal){var index,poly;if(!id){this.unexclude(Object.keys(this._excluded));return}if($.isArray(id)){index=id.length;while(index--){this.unexclude(id[index],true)}if(!conceal){this.notifySelected()}return}poly=id&&this._polygons[id];if(poly){this._setExcludeState(poly,false,true,true)}if(!conceal){this.notifySelected()}},highlight:function(id,style){var index,poly;if($.isArray(id)){index=id.length;while(index--){this.highlight(id[index],style)}return}if(!id){return}this._highlight[id]=true;poly=this._polygons[id];if(poly&&this._active[id]){this._setState(poly,"highlight",style)}},unhighlight:function(id){var index,poly;if(!id){this.unhighlight(Object.keys(this._highlight));return}if($.isArray(id)){index=id.length;while(index--){this.unhighlight(id[index])}return}if(!id){return}delete this._highlight[id];poly=this._polygons[id];if(poly&&this._active[id]){this._setState(poly,"unhighlight")}},hover:function(id){var poly=id&&this._polygons[id];if(poly&&this._active[id]){this._setState(poly,"mouseover")}},unhover:function(id){var poly=id&&this._polygons[id];if(poly&&this._active[id]){this._setState(poly,"mouseout")}},addIcon:function(row,icon){var icon;if(row.id&&row.lat&&row.lng){icon=this._icons[row.id];if(!icon){icon=this.setPin({lat:row.lat,lng:row.lng},icon);this._icons[row.id]=icon;this._activeIcons[row.id]=1}else{if(!this._activeIcons[row.id]){icon.setOptions({map:this.map});this._activeIcons[row.id]=1}}}},removeIcon:function(id){var icon=id&&this._icons[id];if(icon&&this._activeIcons[id]){icon.setOptions({map:null});delete this._activeIcons[id]}},setPin:function(location,icon,center){var fn,pin;if(!location){return}if(location.latitude&&location.longitude){location={lat:location.latitude,lng:location.longitude}}if(typeof location==="string"){fn=function(map){return function(latlng){if(latlng){map.setPin(latlng,icon,center)}}}(this);$.cms.gmap.getLatLng(location,fn)}else{if(center&&this._centerPin){pin=this._centerPin;pin.setAnimation(null);pin.setAnimation(google.maps.Animation.DROP);pin.setOptions({position:location,map:this.map});if(icon){pin.setIcon(icon)}}else{pin=new google.maps.Marker({position:location,map:this.map,animation:this.options.pinAnimation,icon:icon||"//www.scorpioncms.com/common/images/map-marker.png"});if(center){this._centerPin=pin}else{if(!this._pins){this._pins=[]}this._pins.push(pin)}}}return pin},clearPins:function(){var size;if(this._pins){size=this._pins.length;while(size--){this._pins[size].setOptions({map:null})}}if(this._centerPin){this._centerPin.setOptions({map:null})}}});$.extend($.cms.gmap,{LEVEL_STATE:2,LEVEL_COUNTY:3,LEVEL_CITY:4,LEVEL_ZIPCODE:5,cache:{},geo:null,getLatLng:function(address,callback){var latlng;if(!address||typeof address!="string"){return}latlng=$.cms.gmap.cache[address];if(latlng){if($.isFunction(callback)){callback(latlng)}return}if(!$.cms.gmap.geo){$.cms.gmap.geo=new google.maps.Geocoder()}$.cms.gmap.geo.geocode({address:address},function(results,status){var latlng=null;if(status===google.maps.GeocoderStatus.OK){latlng=results[0].geometry.location;$.cms.gmap.cache[address]=latlng}if($.isFunction(callback)){callback(latlng,results,status)}})},fixEvent:function(e){if(e&&e.kb&&!e.kb.button&&mouseButton){console.log(e.kb);e.kb.button=mouseButton}},extend:function(e,poly){var size,sw,lat,lng,ne,coords,bounds;if(!e||!poly){return}else{if($.isArray(poly)){size=poly.length;while(size--){$.cms.gmap.extend(e,poly[size])}}else{if(poly.getSouthWest){sw=poly.getSouthWest();lat=sw.lat();lng=sw.lng();if(lng>160){lng=-179.9}if(!e.minlat||lat<e.minlat){e.minlat=lat}if(!e.minlng||lng<e.minlng){e.minlng=lng}ne=poly.getNorthEast();lat=ne.lat();lng=ne.lng();if(lng>160){lng=-179.9}if(!e.maxlat||lat>e.maxlat){e.maxlat=lat}if(!e.maxlng||lng>e.maxlng){e.maxlng=lng}}else{if(poly.getBounds){bounds=poly.getBounds();$.cms.gmap.extend(e,bounds)}else{if(poly.getPath){coords=poly.getPath().getArray();size=coords.length;bounds=new google.maps.LatLngBounds();while(size--){bounds.extend(coords[size])}$.cms.gmap.extend(e,bounds)}}}}}},overlay:function(m,options){var _map=m;this.options=$.extend({},options);this.show=function(){this.setMap(_map)};this.hide=function(){this.setMap(null)};this.onAdd=function(){if(!this._div){this._div=document.createElement("div");this._div.style.display="block";this._div.style.position="static";this._div.style.margin="0px";this._div.style.padding="0px";this._div.style.overflow="visible";this._div.style.opacity=1}this.getPanes().overlayMouseTarget.appendChild(this._div);$(this._div).on("click",$.proxy(this._onClick,this));if($.isFunction(this.options.init)){this.options.init.apply(this,arguments)}};this.onRemove=function(){if(this._div){$(this._div).off("click");this._div.parentNode.removeChild(this._div)}};this._onClick=function(e){if($.isFunction(this.options.click)){this.options.click.apply(this,arguments)}};this.draw=function(){var proj=this.getProjection(),calc=proj&&function(){var obj,lat,lng,ll;if(arguments.length===1&&(obj=arguments[0])){lat=obj.lat||obj.latitude||obj.Latitude;lng=obj.lng||obj.longitude||obj.Longitude}else{if(arguments.length===2){lat=arguments[0];lng=arguments[1]}}if(lat&&lng){ll=new google.maps.LatLng(lat,lng);return proj.fromLatLngToDivPixel(ll)}else{return null}};if(calc&&$.isFunction(this.options.draw)){this.options.draw.apply(this,[calc])}}},disabled:function(gmap){return gmap.options.multiSelect===MAP_MULTI_SELECT.DISABLE||gmap.options.pointerEvents===MAP_POINTER_EVENTS.NONE},click:function(gmap){return(gmap.options.multiSelect>0&&gmap.options.multiSelect&MAP_MULTI_SELECT.CLICK)===MAP_MULTI_SELECT.CLICK},ctrl:function(gmap){return(gmap.options.multiSelect>0&&gmap.options.multiSelect&MAP_MULTI_SELECT.CTRL)===MAP_MULTI_SELECT.CTRL},toggle:function(gmap){return(gmap.options.multiSelect>0&&gmap.options.multiSelect&MAP_MULTI_SELECT.TOGGLE)===MAP_MULTI_SELECT.TOGGLE},paint:function(gmap){return(gmap.options.multiSelect>0&&gmap.options.multiSelect&MAP_MULTI_SELECT.PAINT)===MAP_MULTI_SELECT.PAINT}});$.cms.gmap.overlay.prototype=new google.maps.OverlayView();if(window.addEventListener){wn_evt=function(type,handler){window.addEventListener(type,handler,true)}}else{if(window.attachEvent){wn_evt=function(type,handler){window.attachEvent("on"+type,handler)}}}wn_evt("mousedown",function(e){mouseDown=true;mouseButton=e.button;if(mouseButton===2&&currentPolygon&&$.cms.gmap.paint(currentPolygon.gmap)){if(shiftKeyPressed&&currentPolygon.excluded){paintUnexclude=true}else{if(shiftKeyPressed){paintExclude=true}else{if(currentPolygon.selected){paintDeselect=true}else{paintSelect=true}}}new google.maps.event.trigger(currentPolygon,"click",{});return StopAll(e)}});wn_evt("mouseup",function(e){mouseDown=false;mouseButton=0;paintSelect=false;paintDeselect=false;paintExclude=false;paintUnexclude=false});wn_evt("keydown",function(e){if(e.repeat){return}ctrlKeyPressed=e.ctrlKey;shiftKeyPressed=e.shiftKey;if(shiftKeyPressed&&currentPolygon){currentPolygon.gmap._setState(currentPolygon)}});wn_evt("keyup",function(e){ctrlKeyPressed=e.ctrlKey;shiftKeyPressed=e.shiftKey;if(!shiftKeyPressed&&currentPolygon){currentPolygon.gmap._setState(currentPolygon)}});wn_evt("mouseout",function(e){var evt=e||window.event||{},from=evt.relatedTarget||evt.toElement;if(!from||!from.nodeName||from.nodeName==="HTML"){mouseDown=false;mouseButton=0;paintDeselect=false;ctrlKeyPressed=false}});if(window.register){window.register("m/gmap")}}));